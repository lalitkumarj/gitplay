<html>
<head>
  <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
  </head>

<body>


<script>
  var targets = [{"primary_description": "a"}, {"primary_description": "b"}];
  var ranks = [[1, .5, .5, 10], [0, .4, .2, 15]];
  var votes = {"0": {"1 stars": 23, "2 stars": 14, "3 stars": 8, "4 stars": 2}, "1": {"5 stars": 1, "3 stars": 9, "1 stars": 20, "2 stars": 13, "4 stars": 1}};

  var combined = ""

  for (var i = 0; i < ranks.length; i++) {
    var string = "";

    // Add rank
    string += [i] + ",";

    // Add caption
    string += "\"" + targets[ranks[i][0]]["primary_description"] + "\",";
    string += ranks[i][1] + "," + ranks[i][2] + "," + ranks[i][3] + ",";

    // Add 1 star votes
    if (typeof votes[ranks[i][0]]["1 stars"] != "undefined") {
      string += votes[ranks[i][0]]["1 stars"] + ",";
    }
    else {
      string += 0 + ",";
    }

    // Add 2 star votes
    if (typeof votes[ranks[i][0]]["2 stars"] != "undefined") {
      string += votes[ranks[i][0]]["2 stars"] + ",";
    }
    else {
      string += 0 + ",";
    }

    // Add 3 star votes
    if (typeof votes[ranks[i][0]]["3 stars"] != "undefined") {
      string += votes[ranks[i][0]]["3 stars"] + ",";
    }
    else {
      string += 0 + ",";
    }

    // Add 4 star votes
    if (typeof votes[ranks[i][0]]["4 stars"] != "undefined") {
      string += votes[ranks[i][0]]["4 stars"] + ",";
    }
    else {
      string += 0 + ",";
    }

    // Add 5 star votes
    if (typeof votes[ranks[i][0]]["5 stars"] != "undefined") {
      string += votes[ranks[i][0]]["5 stars"];
    }
    else {
      string += 0;
    }
    combined += string + "\n";
  }

  console.log(combined);


  function make_csv(){
      $("#test_div").html("<b> Hello </b>");
    }



  function ConvertToCSV(objArray) {
      var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
      var str = '';

      for (var i = 0; i < array.length; i++) {
          var line = '';
          for (var index in array[i]) {
              if (line != '') line += ','

              line += array[i][index];
          }

          str += line + '\n';
      }

      return str;
    }

</script>

<button onclick="make_csv()"> Download CSV </button>
<div id="test_div"> </div>
</body>

</html>
