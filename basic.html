<html>
<head>
  <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
  </head>

<body>


<script>
  var targets = [{"primary_description": "a"}, {"primary_description": "b"}];
  var ranks = [[1, .5, .5, 10], [0, .4, .2, 15]];
  var votes = {"0": {"1 stars": 23, "2 stars": 14, "3 stars": 8, "4 stars": 2}, "1": {"5 stars": 1, "3 stars": 9, "1 stars": 20, "2 stars": 13, "4 stars": 1}};

  var keys = "Rank,Target,T,Î¼,Precision,1 star,2 stars,3 stars,4 stars,5 stars";

  function convert(targets, ranks, votes, keys) {
    var result, string, columnDelimiter, lineDelimiter;

    result = "";
    string = keys + "\n";

    columnDelimiter = ",";
    lineDelimieter = "\n";

    for (var i = 0; i < ranks.length; i++) {
      string += [i] + ",";

      // Add caption
      string += "\"" + targets[ranks[i][0]]["primary_description"] + "\",";
      string += ranks[i][1] + "," + ranks[i][2] + "," + ranks[i][3] + ",";

      string += votes[ranks[i][0]]["1 stars"] + "," || 0 + ",";
      string += votes[ranks[i][0]]["2 stars"] + "," || 0 + ",";
      string += votes[ranks[i][0]]["3 stars"] + "," || 0 + ",";
      string += votes[ranks[i][0]]["4 stars"] + "," || 0 + ",";
      string += votes[ranks[i][0]]["5 stars"] + "\n" || 0 + "\n";
    }

    result += string;
    return result;
  }
  var test = convert(targets, ranks, votes, keys);
  console.log(test);

  function make_csv(){
      $("#test_div").html("<b> Hello </b>");
    }



</script>

<button onclick="make_csv()"> Download CSV </button>
<div id="test_div"> </div>
</body>

</html>
